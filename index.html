  <!DOCTYPE html>
  <html lang="vi">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Seasia Handmade ‚Äì V√≤ng tay may m·∫Øn</title>
    <style>
      :root {
        --cream: #FFFDD0;
        --navy: #0B2340;
        --sea-blue: #005f73;
        --accent: #F4A261;
        --font-serif: 'Playfair Display', serif;
        --font-sans: Arial, sans-serif;
      }
      *,*::before,*::after { box-sizing: border-box; margin: 0; padding: 0; }
      body {
        font-family: var(--font-sans);
        background: var(--cream) url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100"><path d="M0 50 C 25 0, 75 100, 100 50" stroke="%23005f73" fill="none" stroke-width="2" opacity="0.1"/><polygon points="80,10 85,25 100,25 88,35 92,50 80,40 68,50 72,35 60,25 75,25" fill="%23F4A261" opacity="0.1"/></svg>') repeat;
        color: var(--navy);
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 16px;
        position: relative;
      }
  
      /* Navbar */
      nav {
        position: relative;
        background: var(--navy);
        color: var(--cream);
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 20px;
        border-bottom: 4px solid var(--sea-blue);
        box-shadow: inset 0 6px 0 -4px var(--sea-blue);
      }
      nav::before, nav::after {
        content: '';
        position: absolute;
        width: 32px; height: 32px;
        top: 8px;
        background-size: contain;
        background-repeat: no-repeat;
      }
      nav::before {
        left: 8px;
        background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64"><path d="M32 2 L39 24 H62 L43 38 L50 60 L32 46 L14 60 L21 38 L2 24 H25 Z" fill="%23F4A261" opacity="0.3"/></svg>');
      }
      nav::after {
        right: 8px;
        background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64"><path d="M32 2 L39 24 H62 L43 38 L50 60 L32 46 L14 60 L21 38 L2 24 H25 Z" fill="%23F4A261" opacity="0.3"/></svg>');
      }
      .logo { display: flex; align-items: center; }
      .logo img { height: 40px; margin-right: 12px; }
      nav h1 { font-family: var(--font-serif); font-size: 24px; color: var(--accent); }
      .nav-links a {
        color: var(--cream);
        text-decoration: none;
        margin-left: 20px;
        position: relative;
      }
      .nav-links a::after {
        content: '‚òÖ';
        color: var(--accent);
        font-size: 10px;
        position: absolute;
        top: -6px;
        right: -6px;
      }
  
      @media (max-width: 768px) {
        nav {
          flex-direction: column;
          align-items: flex-start;
          gap: 12px;
          padding: 12px;
        }
        .nav-links {
          display: flex;
          flex-wrap: wrap;
          gap: 12px;
        }
      }
  
      /* Carousel */
      .carousel {
        position: relative;
        overflow: hidden;
        height: 40vh;
        margin: 20px auto;
      }
      .carousel img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: none;
      }
      .carousel img.active { display: block; }
      .dots {
        position: absolute;
        bottom: 10px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 8px;
      }
      .dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: rgba(255,255,255,0.7);
        cursor: pointer;
      }
      .dot.active { background: var(--accent); }
  
      @media (max-width: 600px) {
        .carousel { height: 25vh; }
      }
  
      /* Buttons */
      .btn {
        border: none;
        padding: 8px 12px;
        border-radius: 4px;
        cursor: pointer;
      }
      .login-btn { background: var(--sea-blue); color: var(--cream); }
      .cart-btn {
        background: var(--sea-blue);
        color: var(--cream);
        position: relative;
        margin-left: 10px;
      }
      .cart-btn::before { content: 'üêö'; margin-right: 6px; }
  
      /* Modal & Cart */
      .modal {
        display: none;
        position: absolute;
        top: 60px;
        right: 0;
        width: 360px;
        max-height: 80vh;
        overflow-y: auto;
        background: var(--cream);
        color: var(--navy);
        border: 2px solid var(--sea-blue);
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        padding: 20px;
        z-index: 100;
      }
      .modal.open { display: block; }
      .modal h4 {
        font-family: var(--font-serif);
        font-size: 20px;
        color: var(--sea-blue);
        margin-bottom: 12px;
        border-bottom: 2px solid var(--accent);
        padding-bottom: 4px;
      }
      #cart-items .cart-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 10px 0;
        border-bottom: 1px solid #eee;
      }
      .cart-thumb {
        width: 48px;
        height: 48px;
        object-fit: cover;
        border: 1px solid #ccc;
        border-radius: 4px;
      }
      .cart-total {
        font-weight: bold;
        font-size: 16px;
        text-align: right;
        margin-top: 10px;
      }
      #order-btn {
        width: 100%;
        padding: 12px;
        background: var(--sea-blue);
        color: var(--cream);
        border: none;
        border-radius: 6px;
        cursor: pointer;
        margin: 10px 0;
      }
      #order-btn:disabled {
        background: #ccc;
        cursor: not-allowed;
      }
      #order-form input,
      #order-form textarea {
        width: 100%;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
        margin-bottom: 10px;
        font-size: 14px;
      }
  
      @media (max-width: 600px) {
        .modal {
          right: 50%;
          transform: translateX(50%);
          width: calc(100% - 32px);
        }
        #order-form input,
        #order-form textarea {
          font-size: 16px;
        }
      }
  
      /* NEW: Product Search & Filter */
      .filter-container {
          display: flex;
          gap: 16px;
          margin: 20px 0;
          align-items: center;
          flex-wrap: wrap;
      }
      .search-bar {
          flex-grow: 1;
          padding: 10px;
          border: 2px solid var(--sea-blue);
          border-radius: 6px;
          font-size: 16px;
      }
      .filter-btn {
          background: none;
          border: 2px solid var(--sea-blue);
          color: var(--sea-blue);
          font-weight: bold;
          cursor: pointer;
          padding: 10px 16px;
          border-radius: 6px;
          transition: all 0.3s;
      }
      .filter-btn:hover, .filter-btn.active {
          background: var(--sea-blue);
          color: var(--cream);
      }

      /* Products (responsive grid) */
      .products {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 16px;
        padding: 20px 0;
      }
      
      @media (max-width: 768px) {
        .products {
          grid-template-columns: repeat(2, 1fr);
        }
      }
      @media (max-width: 480px) {
        .products {
          grid-template-columns: 1fr;
        }
      }
  
      .product {
        background: var(--cream);
        border-radius: 8px;
        overflow: hidden;
        text-align: center;
        box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        transition: transform .3s;
        padding: 16px;
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      .product:hover { transform: translateY(-5px); }
      .product img {
        width: 100%;
        aspect-ratio: 1 / 1;
        object-fit: cover;
        border-radius: 4px;
        margin-bottom: 12px;
      }
      .product h3 {
        font-family: var(--font-serif);
        color: var(--sea-blue);
        margin: 8px 0;
        font-size: 18px;
      }
      .product p {
        font-weight: bold;
        margin: 4px 0 12px;
      }
      .color-options {
        display: flex;
        justify-content: center;
        gap: 8px;
        margin-bottom: 12px;
      }
      .color-dot {
        width: 20px;
        height: 20px;
        border: 2px solid #ccc;
        border-radius: 50%;
        cursor: pointer;
        transition: border-color 0.3s;
      }
      .color-dot.selected {
        border-color: var(--accent);
      }
      .product button, .product .view-more-btn {
        background: var(--accent);
        border: none;
        padding: 10px 16px;
        width: 100%;
        color: var(--navy);
        font-weight: bold;
        border-radius: 6px;
        cursor: pointer;
        transition: background-color 0.3s;
        margin-top: auto; /* Pushes button to bottom */
      }
      .product button:hover, .product .view-more-btn:hover {
        background: #d68a4e;
      }

      /* NEW: Product Detail Modal */
      .detail-modal-backdrop {
          display: none;
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0,0,0,0.6);
          z-index: 200;
          justify-content: center;
          align-items: center;
      }
      .detail-modal-backdrop.open {
          display: flex;
      }
      .detail-modal-content {
          background: var(--cream);
          padding: 24px;
          border-radius: 12px;
          width: 90%;
          max-width: 800px;
          max-height: 90vh;
          overflow-y: auto;
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 24px;
          position: relative;
      }
      .detail-modal-close {
          position: absolute;
          top: 10px;
          right: 15px;
          font-size: 28px;
          font-weight: bold;
          cursor: pointer;
          color: var(--navy);
      }
      #detail-img {
          width: 100%;
          aspect-ratio: 1/1;
          object-fit: cover;
          border-radius: 8px;
      }
      #detail-name {
          font-family: var(--font-serif);
          font-size: 28px;
          color: var(--sea-blue);
      }
      #detail-price {
          font-size: 22px;
          font-weight: bold;
          color: var(--accent);
          margin: 10px 0;
      }
      #detail-story {
          font-size: 15px;
          line-height: 1.6;
          margin: 15px 0;
          font-style: italic;
      }
      .quantity-control {
          display: flex;
          align-items: center;
          gap: 10px;
          margin-top: 15px;
      }
      #detail-qty {
          width: 60px;
          padding: 8px;
          text-align: center;
          font-size: 16px;
          border: 2px solid var(--sea-blue);
          border-radius: 4px;
      }
      #detail-add-to-cart {
          width: 100%;
          padding: 12px;
          margin-top: 16px;
          background: var(--sea-blue);
          color: var(--cream);
          border-radius: 6px;
          font-size: 16px;
          font-weight: bold;
          cursor: pointer;
      }

      @media (max-width: 768px) {
          .detail-modal-content {
              grid-template-columns: 1fr;
              padding: 20px;
              max-height: 85vh;
          }
          #detail-name { font-size: 24px; }
          #detail-price { font-size: 20px; }
      }
  
      /* Footer */
      footer {
        background: var(--navy);
        color: var(--cream);
        padding: 20px;
        text-align: center;
        font-size: 14px;
        margin-top: 30px;
      }
      footer a {
        color: var(--accent);
        text-decoration: none;
      }
    </style>
  
    <script src="https://accounts.google.com/gsi/client" async defer></script>
  </head>
  <body>
    <nav>
      <div class="logo"><img src="logo.png" alt="Logo"><h1>Seasia Handmade</h1></div>
      <div class="nav-links"><a href="#">Trang ch·ªß</a><a href="#">S·∫£n ph·∫©m</a><a href="#">Li√™n h·ªá</a></div>
      <div>
        <button id="login-btn" class="btn login-btn">ƒêƒÉng nh·∫≠p</button>
        <button id="cart-btn" class="btn cart-btn">Gi·ªè (<span id="cart-count">0</span>)</button>
        <div id="login-modal" class="modal"><h4>ƒêƒÉng nh·∫≠p</h4><input id="user" placeholder="T√†i kho·∫£n"><input id="pass" type="password" placeholder="M·∫≠t kh·∫©u"><button id="login-submit">ƒêƒÉng nh·∫≠p</button></div>
        <div id="cart-modal" class="modal">
          <h4>Gi·ªè h√†ng</h4>
          <div id="cart-items"></div>
          <div class="cart-total">T·ªïng ti·ªÅn: <span id="cart-total">0 ƒë</span></div>
          <form id="order-form">
            <input id="name" placeholder="H·ªç & T√™n" required>
            <input id="phone" type="tel" placeholder="S·ªë ƒëi·ªán tho·∫°i" pattern="\d{10,11}" required>
            <textarea id="address" rows="2" placeholder="ƒê·ªãa ch·ªâ" required></textarea>
            <textarea id="note" rows="2" placeholder="Ghi ch√∫"></textarea>
            <button id="order-btn" type="button" disabled>ƒê·∫∑t h√†ng</button>
          </form>
        </div>
      </div>
    </nav>

    <div class="carousel" id="banner" tabindex="0">
      <img src="banner1.png" class="active" alt="Banner 1" loading="lazy">
      <img src="banner2.png" alt="Banner 2">
      <img src="banner3.png" alt="Banner 3">
      <div class="dots" id="dots"></div>
    </div>

    <div class="filter-container">
        <input type="search" id="search-bar" class="search-bar" placeholder="üîç T√¨m ki·∫øm v√≤ng tay...">
        <div>
          <button class="filter-btn active" data-filter="all">T·∫•t c·∫£</button>
          <button class="filter-btn" data-filter="under55k">D∆∞·ªõi 55.000ƒë</button>
          <button class="filter-btn" data-filter="over55k">T·ª´ 55.000ƒë</button>
        </div>
    </div>
    
    <section class="products" id="product-list"></section>

    <div id="product-detail-modal" class="detail-modal-backdrop">
        <div class="detail-modal-content">
            <span class="detail-modal-close">&times;</span>
            <div class="modal-left">
                <img id="detail-img" src="" alt="Chi ti·∫øt s·∫£n ph·∫©m">
            </div>
            <div class="modal-right">
                <h2 id="detail-name"></h2>
                <p id="detail-price"></p>
                <p id="detail-story"></p>
                <div id="detail-color-options" class="color-options"></div>
                <div class="quantity-control">
                    <label for="detail-qty">S·ªë l∆∞·ª£ng:</label>
                    <input type="number" id="detail-qty" value="1" min="1">
                </div>
                <button id="detail-add-to-cart" data-id="">Th√™m v√†o gi·ªè</button>
            </div>
        </div>
    </div>

    <footer><p>¬© 2025 Seasia Handmade ‚Äì K·∫øt n·ªëi bi·ªÉn v√† may m·∫Øn ‚ú®üê†</p></footer>

    <script>
      // Carousel setup
      const banner = document.getElementById('banner'), slides = banner.querySelectorAll('img'), dotsContainer = document.getElementById('dots');
      let currentSlide = 0, interval;
      if (slides.length > 0) {
          slides.forEach((_, i) => { const dot = document.createElement('div'); dot.className='dot'; dot.onclick = () => showSlide(i); dotsContainer.appendChild(dot); });
          const dots = dotsContainer.querySelectorAll('.dot');
          function showSlide(i) { if (!slides[currentSlide]) return; slides[currentSlide].classList.remove('active'); dots[currentSlide].classList.remove('active'); currentSlide = i; slides[i].classList.add('active'); dots[i].classList.add('active'); }
          function nextSlide() { showSlide((currentSlide+1)%slides.length); }
          function startAuto() { interval = setInterval(nextSlide, 5000); }
          function stopAuto() { clearInterval(interval); }
          banner.addEventListener('mouseenter', stopAuto); banner.addEventListener('mouseleave', startAuto); showSlide(0); startAuto();
      }
      
      // Login modal
      const loginBtn = document.getElementById('login-btn'), loginModal = document.getElementById('login-modal'), loginSubmit = document.getElementById('login-submit');
      let loggedIn = localStorage.getItem('loggedIn')==='true';
      function updateLoginState() { if (loggedIn) { loginBtn.style.display='none'; document.getElementById('order-btn').disabled = cart.length === 0; } else { loginBtn.style.display='inline-block'; document.getElementById('order-btn').disabled=true; } }
      loginBtn.onclick = () => loginModal.classList.toggle('open');
      loginSubmit.onclick = () => { if (document.getElementById('user').value && document.getElementById('pass').value) { loggedIn=true; localStorage.setItem('loggedIn','true'); updateLoginState(); alert('ƒêƒÉng nh·∫≠p th√†nh c√¥ng!'); loginModal.classList.remove('open'); } else alert('Nh·∫≠p ƒë·∫ßy ƒë·ªß!'); };
      document.addEventListener('click', e => { if (!loginModal.contains(e.target) && e.target!==loginBtn) loginModal.classList.remove('open'); });

      // Product & Cart logic
      const products = [
        {id:1, name:'Butterfly Sealine', price:50000, colors:{yellow:'img1.1.png',purple:'img1.2.png',blue:'img1.3.png',pink:'img1.4.png'}, story: "Butterfly Sealine mang ƒë·∫øn h√¨nh ·∫£nh nh·ªØng c√°nh b∆∞·ªõm v√†ng r·ª±c r·ª°, t·ª± do bay l∆∞·ª£n tr√™n ƒë∆∞·ªùng ch√¢n tr·ªùi n∆°i bi·ªÉn xanh ng√∫t ng√†n. ƒê√¢y l√† bi·ªÉu t∆∞·ª£ng c·ªßa s·ª± t·ª± do, ni·ªÅm hy v·ªçng v√† nh·ªØng kh·ªüi ƒë·∫ßu m·ªõi ƒë·∫ßy r·ª±c r·ª°. Chi·∫øc v√≤ng nh·∫Øc nh·ªü b·∫°n h√£y lu√¥n l·∫°c quan, s·ªëng tr·ªçn v·∫πn t·ª´ng kho·∫£nh kh·∫Øc, v√† t√¨m th·∫•y v·∫ª ƒë·∫πp trong nh·ªØng ƒëi·ªÅu b√¨nh d·ªã nh·∫•t."},
        {id:2, name:'Super Sunday', price:50000, colors:{turquoise:'2.1.png',pink:'2.2.png',blue:'2.3.png',yellow:'2.4.png'}, story: "Super Sunday l√† hi·ªán th√¢n c·ªßa m·ªôt bu·ªïi chi·ªÅu Ch·ªß Nh·∫≠t d·ªãu m√°t, b√¨nh y√™n b√™n b·ªù bi·ªÉn. N∆°i ng√¥i sao bi·ªÉn nh·ªè b√© th√¨ th·∫ßm nh·ªØng ∆∞·ªõc nguy·ªán, v√† nh·ªØng h·∫°t ng·ªçc trai l·∫•p l√°nh nh∆∞ b·ªçt s√≥ng tr·∫Øng x√≥a. Chi·∫øc v√≤ng n√†y l√† l·ªùi nh·∫Øc nh·ªü b·∫°n v·ªÅ nh·ªØng kho·∫£nh kh·∫Øc th∆∞ th√°i, ƒë·ªÉ b·∫°n c√≥ th·ªÉ t·∫≠n h∆∞·ªüng tr·ªçn v·∫πn s·ª± b√¨nh y√™n v√† h·∫°nh ph√∫c gi·∫£n d·ªã c·ªßa cu·ªôc s·ªëng."},
        {id:3, name:'Ocean Dreamer', price:50000, colors:{blue:'3.1.png',pink:'3.2.png'}, story: "Ocean Dreamer l√† gi·∫•c m∆° v·ªÅ ƒë·∫°i d∆∞∆°ng bao la, n∆°i s·∫Øc xanh th·∫≥m c·ªßa bi·ªÉn s√¢u √¥m ·∫•p nh·ªØng b√≠ m·∫≠t, v√† ng√¥i sao bi·ªÉn d·∫´n l·ªëi cho nh·ªØng t√¢m h·ªìn m·ªông m∆°. Chi·∫øc v√≤ng n√†y d√†nh cho nh·ªØng ai lu√¥n khao kh√°t kh√°m ph√°, lu√¥n m∆° m·ªông v·ªÅ nh·ªØng ƒëi·ªÅu m·ªõi m·∫ª v√† kh√¥ng ng·ª´ng chinh ph·ª•c nh·ªØng ch√¢n tr·ªùi r·ªông l·ªõn."},
        {id:4, name:'Breath Of The Sea', price:60000, colors:{green:'4.2.png',blue:'4.3.png'}, story: "Breath Of The Sea - H∆°i th·ªü c·ªßa bi·ªÉn c·∫£, mang theo s·ª± trong l√†nh v√† t∆∞∆°i m√°t. Ch√∫ c√° nh·ªè t·ª± do b∆°i l·ªôi gi·ªØa nh·ªØng h·∫°t ng·ªçc xanh ng·ªçc b√≠ch nh∆∞ n∆∞·ªõc bi·ªÉn trong v·∫Øt. Chi·∫øc v√≤ng n√†y t∆∞·ª£ng tr∆∞ng cho s·ª± an nhi√™n, t·ª± t·∫°i, v√† c·∫£m gi√°c ƒë∆∞·ª£c h√≤a m√¨nh v√†o thi√™n nhi√™n t∆∞∆°i ƒë·∫πp, xua tan m·ªçi mu·ªôn phi·ªÅn."},
        {id:5, name:'Double Star', price:50000, colors:{white:'5.1.png',pink:'5.2.png'}, story: "Double Star v·ªõi hai ng√¥i sao bi·ªÉn m√†u h·ªìng r·ª±c r·ª°, t∆∞·ª£ng tr∆∞ng cho nh·ªØng m·ªëi quan h·ªá b·ªÅn ch·∫∑t. ƒê√≥ c√≥ th·ªÉ l√† t√¨nh b·∫°n th√¢n thi·∫øt, t√¨nh y√™u ƒë√¥i l·ª©a, hay s·ª± g·∫Øn k·∫øt ƒë·∫∑c bi·ªát v·ªõi m·ªôt ai ƒë√≥. Chi·∫øc v√≤ng l√† m√≥n qu√† √Ω nghƒ©a ƒë·ªÉ b·∫°n v√† nh·ªØng ng∆∞·ªùi th√¢n y√™u c√πng nhau t·ªèa s√°ng, c√πng nhau chia s·∫ª nh·ªØng kho·∫£nh kh·∫Øc ƒë√°ng nh·ªõ trong cu·ªôc ƒë·ªùi."},
        {id:6, name:'Tide Bracelet', price:60000, colors:{orange:'6.1.png',yellow:'6.2.png', green: '6.3.png'}, story: "Tide Bracelet l√† h√¨nh ·∫£nh c·ªßa s·ª± l√™n xu·ªëng c·ªßa th·ªßy tri·ªÅu, v·ªõi s·∫Øc cam c·ªßa ho√†ng h√¥n r·ª±c r·ª° tr√™n bi·ªÉn v√† nh·ªØng h·∫°t ƒë√° l·∫•p l√°nh nh∆∞ c√°t v√†ng. Chi·∫øc v√≤ng nh·∫Øc nh·ªü ch√∫ng ta v·ªÅ s·ª± thay ƒë·ªïi kh√¥ng ng·ª´ng c·ªßa cu·ªôc s·ªëng, v√† r·∫±ng sau m·ªói con s√≥ng l·ªõn, b√¨nh minh s·∫Ω l·∫°i ƒë·∫øn, mang theo nh·ªØng kh·ªüi ƒë·∫ßu m·ªõi ƒë·∫ßy hy v·ªçng."}
      ];
      let cart = JSON.parse(localStorage.getItem('cart'))||[];
      let searchTerm = '';
      let priceFilter = 'all';

      function saveCart() { localStorage.setItem('cart', JSON.stringify(cart)); }

      function renderProducts(filteredProducts) {
        const list = document.getElementById('product-list'); 
        list.innerHTML='';
        if (filteredProducts.length === 0) {
          list.innerHTML = `<p>Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m ph√π h·ª£p.</p>`;
          return;
        }
        filteredProducts.forEach(p => { 
          p.selectedColor = p.defaultColor||Object.keys(p.colors||{})[0];
          const imgSrc = p.colors ? p.colors[p.selectedColor] : p.img;
          list.innerHTML += `<div class="product">
              <img src="${imgSrc}">
              <h3>${p.name}</h3>
              <p>${p.price.toLocaleString()} ƒë</p>
              <button class="view-more-btn" data-id="${p.id}">Xem th√™m</button>
          </div>`;
        });
        document.querySelectorAll('.view-more-btn').forEach(btn => btn.onclick = e => showProductDetail(+e.target.dataset.id));
      }

      function displayProducts() {
          let filtered = products.filter(p => p.name.toLowerCase().includes(searchTerm));
          
          if (priceFilter === 'under55k') {
              filtered = filtered.filter(p => p.price < 55000);
          } else if (priceFilter === 'over55k') {
              filtered = filtered.filter(p => p.price >= 55000);
          }
          
          renderProducts(filtered);
      }

      // --- NEW: Product Detail Modal Logic ---
      const detailModal = document.getElementById('product-detail-modal');
      const detailCloseBtn = detailModal.querySelector('.detail-modal-close');
      const detailImg = document.getElementById('detail-img');
      const detailName = document.getElementById('detail-name');
      const detailPrice = document.getElementById('detail-price');
      const detailStory = document.getElementById('detail-story');
      const detailColors = document.getElementById('detail-color-options');
      const detailQty = document.getElementById('detail-qty');
      const detailAddToCartBtn = document.getElementById('detail-add-to-cart');
      
      function showProductDetail(id) {
          const prod = products.find(p => p.id === id);
          if (!prod) return;

          // Populate modal data
          detailName.textContent = prod.name;
          detailPrice.textContent = `${prod.price.toLocaleString()} ƒë`;
          detailStory.textContent = prod.story;
          detailAddToCartBtn.dataset.id = id;
          
          // Handle colors
          prod.selectedColor = Object.keys(prod.colors)[0]; // Reset to first color
          detailImg.src = prod.colors[prod.selectedColor];
          detailColors.innerHTML = Object.keys(prod.colors).map(c => 
              `<span class="color-dot${c === prod.selectedColor ? ' selected' : ''}" style="background:${c}" data-id="${prod.id}" data-color="${c}"></span>`
          ).join('');

          // Add event listeners for new color dots in modal
          detailColors.querySelectorAll('.color-dot').forEach(d => d.onclick = e => {
              const color = e.target.dataset.color;
              prod.selectedColor = color;
              detailImg.src = prod.colors[color];
              detailColors.querySelectorAll('.color-dot').forEach(x => x.classList.remove('selected'));
              e.target.classList.add('selected');
          });

          // Reset quantity and show modal
          detailQty.value = 1;
          detailModal.classList.add('open');
      }
      
      // Event listeners to close the detail modal
      detailCloseBtn.onclick = () => detailModal.classList.remove('open');
      detailModal.onclick = (e) => {
          if (e.target === detailModal) { // Click on backdrop only
              detailModal.classList.remove('open');
          }
      };
      
      // --- UPDATE: addToCart function to handle quantity ---
      function addToCart(id, quantity) {
        const prod = products.find(x=>x.id===id);
        const color = prod.selectedColor;
        const imgSrc = prod.colors ? prod.colors[color] : prod.img;
        const exist = cart.find(x=>x.id===id && x.color===color);
        
        if (exist) {
          exist.qty += quantity;
        } else {
          cart.push({id, name:prod.name, price:prod.price, color, qty:quantity, imgSrc});
        }
        updateCart();
      }

      // Event listener for the "Add to Cart" button inside the detail modal
      detailAddToCartBtn.onclick = (e) => {
          const id = +e.target.dataset.id;
          const quantity = +detailQty.value;
          if (quantity > 0) {
              addToCart(id, quantity);
              alert(`ƒê√£ th√™m ${quantity} s·∫£n ph·∫©m v√†o gi·ªè h√†ng!`);
              detailModal.classList.remove('open');
          }
      };

      function updateCart() {
        const container = document.getElementById('cart-items'); container.innerHTML=''; let total=0;
        cart.forEach(item=>{
          total += item.price*item.qty;
          const div=document.createElement('div'); div.className='cart-item';
          div.innerHTML = `<img class="cart-thumb" src="${item.imgSrc}"><div><p><strong>${item.name}</strong> (${item.color})</p><p>${item.price.toLocaleString()} ƒë √ó ${item.qty} = ${(item.price*item.qty).toLocaleString()} ƒë</p></div><button class="remove" data-id="${item.id}" data-color="${item.color}">X√≥a</button>`;
          container.appendChild(div);
        });
        document.getElementById('cart-count').innerText = cart.reduce((s,i)=>s+i.qty,0);
        document.getElementById('cart-total').innerText = total.toLocaleString() + ' ƒë';
        
        // Update order button state based on both login status and cart content
        document.getElementById('order-btn').disabled = cart.length === 0 || !loggedIn;
        
        document.querySelectorAll('.remove').forEach(b=> b.onclick=e=> removeFromCart(+e.target.dataset.id, e.target.dataset.color));
        saveCart();
      }
      
      // UPDATE: removeFromCart to handle items with specific colors
      function removeFromCart(id, color) { 
          cart = cart.filter(x => !(x.id === id && x.color === color)); 
          updateCart(); 
      }

      document.getElementById('cart-btn').onclick = ()=> document.getElementById('cart-modal').classList.toggle('open');
      document.addEventListener('click', e=>{ const m=document.getElementById('cart-modal'); if(!m.contains(e.target)&&e.target.id!=='cart-btn') m.classList.remove('open'); });

      // --- NEW: Event Listeners for Search and Filter ---
      document.getElementById('search-bar').addEventListener('input', e => {
          searchTerm = e.target.value.toLowerCase().trim();
          displayProducts();
      });

      document.querySelectorAll('.filter-btn').forEach(btn => {
          btn.addEventListener('click', e => {
              document.querySelector('.filter-btn.active').classList.remove('active');
              e.target.classList.add('active');
              priceFilter = e.target.dataset.filter;
              displayProducts();
          });
      });

      // --- X·ª¨ L√ù G·ª¨I ƒê∆†N H√ÄNG ---
      const orderBtn = document.getElementById('order-btn');
      orderBtn.addEventListener('click', () => {
        const form = document.getElementById('order-form');
        if (!form.checkValidity()) {
          form.reportValidity();
          return alert('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin giao h√†ng c√≥ d·∫•u (*).');
        }

        const customer = {
          name: document.getElementById('name').value.trim(),
          phone: document.getElementById('phone').value.trim(),
          address: document.getElementById('address').value.trim(),
          note: document.getElementById('note').value.trim()
        };

        const payload = {
          customer,
          items: cart.map(item => ({ productId: item.id, name: item.name, color: item.color, qty: item.qty, price: item.price })),
          total: cart.reduce((sum, i) => sum + i.price * i.qty, 0),
          timestamp: new Date().toISOString()
        };

        // G·ª≠i l√™n backend
        fetch('https://seasiahandmade-vn-com.onrender.com/api/orders', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        })
        .then(res => {
            if (!res.ok) { throw new Error('Network response was not ok'); }
            return res.json();
        })
        .then(data => {
          if (data.success) {
            alert(`ƒê·∫∑t h√†ng th√†nh c√¥ng! M√£ ƒë∆°n h√†ng c·ªßa b·∫°n l√†: ${data.orderId}`);
            cart = [];
            saveCart();
            updateCart();
            document.getElementById('order-form').reset();
            document.getElementById('cart-modal').classList.remove('open');
          } else {
            throw new Error(data.message || 'L·ªói t·ª´ server khi ƒë·∫∑t h√†ng.');
          }
        })
        .catch(err => {
          console.error('L·ªói ƒë·∫∑t h√†ng:', err);
          alert('R·∫•t ti·∫øc, ƒë√£ c√≥ l·ªói x·∫£y ra khi c·ªë g·∫Øng ƒë·∫∑t h√†ng. Vui l√≤ng th·ª≠ l·∫°i sau.');
        });
      });

      // Initial render
      displayProducts(); 
      updateCart();
      updateLoginState(); // Call this again to set initial state of order button

    </script>
  </body>
  </html>
